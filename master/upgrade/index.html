

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             ScyllaDB Manager Upgrade | ScyllaDB Docs 
        </title>
        <meta name="description" content="ScyllaDB is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
        

        
            
            <link rel="canonical" href="https://manager.docs.scylladb.com/stable/upgrade/"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../"
            src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../_static/underscore.js"></script>
            
        
            
                <script src="../_static/doctools.js"></script>
            
        
            
                <script src="../_static/clipboard.min.js"></script>
            
        
            
                <script src="../_static/copybutton.js"></script>
            
        
    
            
                <!-- Zendesk tag -->
<meta name='zd-site-verification' content='gq6ltsh3nfex3cnwfy4aj9' />

<!-- Google Tag Manager global -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager docs -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-54NWVS4");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
            
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        <section class="promo-banner  promo-banner--hide" style="display: none;">
    <div class="promo-banner-wrapper">
        
        <div class="promo-banner__title">ScyllaDB University Live | Free Virtual Training Event</div>
        <a class="promo-banner__button button button--reverse" href="#"
            target="_blank" rel="noopener noreferrer">Learn more</a>
        <button class="promo-banner__close">
            <i class="scylla-icon scylla-icon--close"></i>
        </button>
    </div>
</section>
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/logo-docs.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            ScyllaDB Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://enterprise.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>ScyllaDB Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            ScyllaDB Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="https://docs.scylladb.com/scylla-cloud/" class="scylla-dropdown__title">Cloud</a>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for an unstable version of Scylla Manager.
            
            <a href="../../stable/upgrade/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="../index.html"
            class="bread__highlight">
            Scylla Manager
        </a>
    </span>
    
    <span class="bread__item bread__item--last">ScyllaDB Manager Upgrade</span>
</div>
                    </div>
                
                <section id="scylladb-manager-upgrade">
<h1>ScyllaDB Manager Upgrade<a class="headerlink" href="#scylladb-manager-upgrade" title="Permalink to this headline">¶</a></h1>
<p>This document describes the upgrade process beween two versions of Scylla Manager.</p>
<section id="applicable-versions">
<h2>Applicable versions<a class="headerlink" href="#applicable-versions" title="Permalink to this headline">¶</a></h2>
<p>This guide covers the general steps for upgrading Scylla Manager between any two versions on the following platforms:</p>
<ul class="simple">
<li><p>Red Hat Enterprise Linux, version 7</p></li>
<li><p>CentOS, version 7</p></li>
<li><p>Debian, version 9</p></li>
<li><p>Ubuntu, versions 16.04, 18.04</p></li>
</ul>
</section>
<section id="upgrade-procedure">
<h2>Upgrade Procedure<a class="headerlink" href="#upgrade-procedure" title="Permalink to this headline">¶</a></h2>
<p>Upgrade procedure for the Scylla Manager includes upgrade of three components server, client, and the agent. Entire cluster shutdown is NOT needed. Scylla will be running while the manager components are upgraded. Overview of the required steps:</p>
<ul class="simple">
<li><p>Stop all Scylla Manager tasks (or wait for them to finish)</p></li>
<li><p>Stop the Scylla Manager Server</p></li>
<li><p>Stop the Scylla Manager Agent on all nodes</p></li>
<li><p>Upgrade the Scylla Manager Server and Client</p></li>
<li><p>Upgrade the Scylla Manager Agent on all nodes</p></li>
<li><p>Run <cite>scyllamgr_agent_setup</cite> script on all nodes</p></li>
<li><p>Reconcile configuration files</p></li>
<li><p>Start the upgraded Scylla Manager Agent on all nodes</p></li>
<li><p>Start the upgraded Scylla Manager Server</p></li>
<li><p>Validate status of the cluster</p></li>
</ul>
</section>
<section id="upgrade-steps">
<h2>Upgrade steps<a class="headerlink" href="#upgrade-steps" title="Permalink to this headline">¶</a></h2>
<section id="stop-all-scylla-manager-tasks-or-wait-for-them-to-finish">
<h3>Stop all Scylla Manager tasks (or wait for them to finish)<a class="headerlink" href="#stop-all-scylla-manager-tasks-or-wait-for-them-to-finish" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> check current status of the manager tasks:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool task list -c &lt;cluster&gt;
</pre></div>
</div>
<p>Or on versions 3.0 and higher using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool tasks -c &lt;cluster&gt;
</pre></div>
</div>
<p>None of the listed tasks should have status in RUNNING.</p>
</section>
<section id="stop-the-scylladb-manager-server">
<h3>Stop the ScyllaDB Manager Server<a class="headerlink" href="#stop-the-scylladb-manager-server" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> instruct Systemd to stop the server process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop scylla-manager
</pre></div>
</div>
<p>Ensure that it is stopped with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager
</pre></div>
</div>
<p>It should have a status of <em>“Active: inactive (dead)”</em>.</p>
</section>
<section id="stop-the-scylladb-manager-agent-on-all-nodes">
<h3>Stop the ScyllaDB Manager Agent on all nodes<a class="headerlink" href="#stop-the-scylladb-manager-agent-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<p><strong>On each scylla node</strong> in the cluster run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop scylla-manager-agent
</pre></div>
</div>
<p>Ensure that it is stopped with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager-agent
</pre></div>
</div>
<p>It should have a status of <em>“Active: inactive (dead)”</em>.</p>
</section>
<section id="upgrade-the-scylladb-manager-server-and-client">
<h3>Upgrade the ScyllaDB Manager Server and Client<a class="headerlink" href="#upgrade-the-scylladb-manager-server-and-client" title="Permalink to this headline">¶</a></h3>
<p><strong>Before you Begin</strong></p>
<p>Confirm that the settings for <code class="docutils literal notranslate"><span class="pre">scylla-manager.repo</span></code> are correct.</p>
<p><strong>On the Manager Server</strong> display the contents of the scylla-manager.repo and confirm the version displayed is the desired version, in this example 3.0.</p>
<p>CentOS, Red Hat:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cat /etc/yum.repos.d/scylla-manager.repo

<span class="o">[</span>scylla-manager-3.0<span class="o">]</span> <span class="nv">name</span><span class="o">=</span>Scylla Manager <span class="k">for</span> Centos - <span class="nv">$basearch</span> <span class="nv">baseurl</span><span class="o">=</span>http://downloads.scylladb.com/downloads/scylla-manager/rpm/centos/scylladb-manager-3.0/<span class="nv">$basearch</span>/ <span class="nv">enabled</span><span class="o">=</span><span class="m">1</span> <span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>Debian, Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cat /etc/apt/sources.list/scylla-manager.repo

<span class="o">[</span>scylla-manager-3.0<span class="o">]</span> <span class="nv">name</span><span class="o">=</span>Scylla Manager <span class="k">for</span> Centos - <span class="nv">$basearch</span> <span class="nv">baseurl</span><span class="o">=</span>http://downloads.scylladb.com/downloads/scylla-manager/rpm/centos/scylladb-manager-3.0/<span class="nv">$basearch</span>/ <span class="nv">enabled</span><span class="o">=</span><span class="m">1</span> <span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p><strong>On the Manager Server</strong> instruct package manager to update server and the client:</p>
<p>CentOS, Red Hat:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo yum update scylla-manager-server scylla-manager-client -y
</pre></div>
</div>
<p>Debian, Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install scylla-manager-server scylla-manager-client -y
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using apt-get, if a previous version of the Scylla Manager package had a modified configuration file, you will be asked what to do with this file during the installation process. In order to keep both files for reconciliation (covered later in the procedure), select the “keep your currently-installed version” option when prompted.</p>
</div>
</section>
<section id="upgrade-the-scylladb-manager-agent-on-all-nodes">
<h3>Upgrade the ScyllaDB Manager Agent on all nodes<a class="headerlink" href="#upgrade-the-scylladb-manager-agent-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<p><strong>On each scylla node</strong> instruct package manager to update the agent:</p>
<p>CentOS, Red Hat:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo yum update scylla-manager-agent -y
</pre></div>
</div>
<p>Debian, Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install scylla-manager-agent -y
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With apt-get, if a previous version of the package had a modified configuration file, you will be asked during installation what to do with it. Please select “keep your currently-installed version” option to keep both previous and new default configuration file for later reconciliation.</p>
</div>
</section>
<section id="run-scyllamgr-agent-setup-script-on-all-nodes">
<h3>Run <cite>scyllamgr_agent_setup</cite> script on all nodes<a class="headerlink" href="#run-scyllamgr-agent-setup-script-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Script mentioned in this section is added in version 2.0.2 so it won’t be available for earlier versions.</p>
</div>
<p>This step requires sudo rights:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ sudo scyllamgr_agent_setup
Do you want to create scylla-helper.slice <span class="k">if</span> it does not exist?
Yes - limit Scylla Manager Agent and other helper programs memory. No - skip this step.
<span class="o">[</span>YES/no<span class="o">]</span> YES
Do you want the Scylla Manager Agent service to automatically start when the node boots?
Yes - automatically start Scylla Manager Agent when the node boots. No - skip this step.
<span class="o">[</span>YES/no<span class="o">]</span> YES
</pre></div>
</div>
<p>First step relates to limiting resources that are available to the agent and second
instructs systemd to run agent on node restart.</p>
</section>
<section id="reconcile-configuration-files">
<h3>Reconcile configuration files<a class="headerlink" href="#reconcile-configuration-files" title="Permalink to this headline">¶</a></h3>
<p>Upgrades can create changes to the structure and values of the default yaml configuration file. If the previous version’s configuration file was modified with custom values, this could result in a conflict. The upgrade procedure can’t resolve this without help from an administrator. If you followed instructions from the upgrade packages sections of this document, and you elected to save both the new and old configuration files, the new version of the configuration file is saved in the same directory as the old one with an added extension suffix for both server and agent. These files are stored in the <cite>/etc/scylla-manager</cite> directory.</p>
<p>On a CentOS configuration, a conflict looks like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the Scylla Manager node</span>
/etc/scylla-manager/scylla-manager.yaml <span class="c1"># old file containing custom values</span>
/etc/scylla-manager/scylla-manager.yaml.rpmnew <span class="c1"># new default file from new version</span>
<span class="c1"># On all Scylla nodes</span>
/etc/scylla-manager-agent/scylla-manager-agent.yaml <span class="c1"># old file containing custom values</span>
/etc/scylla-manager-agent/scylla-manager-agent.yaml.rpmnew <span class="c1"># new default file from new version</span>
</pre></div>
</div>
<p>On an Ubuntu configuration, a conflict looks like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the Scylla Manager node</span>
/etc/scylla-manager/scylla-manager.yaml <span class="c1"># old file containing custom values</span>
/etc/scylla-manager/scylla-manager.yaml.dpkg-dist <span class="c1"># new default file from new version</span>
<span class="c1"># On all Scylla nodes</span>
/etc/scylla-manager-agent/scylla-manager-agent.yaml <span class="c1"># old file containing custom values</span>
/etc/scylla-manager-agent/scylla-manager-agent.yaml.dpkg-dist <span class="c1"># new default file from new version</span>
</pre></div>
</div>
<p>It is required to manually inspect both files and reconcile old values with the new configuration. Remember to carry over any custom values like database credentials, backup, repair, and any other configuration. This can be done by manually updating values in the new config file and then renaming files:</p>
<p>For CentOS:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the Scylla Manager node</span>
<span class="nb">cd</span> /etc/scylla-manager/
mv scylla-manager.yaml scylla-manager.yaml.old  <span class="c1">#renames the old config file as old</span>
mv scylla-manager.yaml.rpmnew scylla-manager.yaml
<span class="c1"># On all Scylla nodes</span>
<span class="nb">cd</span> /etc/scylla-manager-agent/
mv scylla-manager-agent.yaml scylla-manager-agent.yaml.old
mv scylla-manager-agent.yaml.rpmnew scylla-manager-agent.yaml
</pre></div>
</div>
<p>For Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the Scylla Manager node</span>
<span class="nb">cd</span> /etc/scylla-manager/
mv scylla-manager.yaml scylla-manager.yaml.old
mv scylla-manager.yaml.dpkg-dist scylla-manager.yaml
<span class="c1"># On all Scylla nodes</span>
<span class="nb">cd</span> /etc/scylla-manager-agent/
mv scylla-manager-agent.yaml scylla-manager-agent.yaml.old
mv scylla-manager-agent.yaml.dpkg-dist scylla-manager-agent.yaml
</pre></div>
</div>
</section>
<section id="start-the-scylladb-manager-agent-on-all-nodes">
<h3>Start the ScyllaDB Manager Agent on all nodes<a class="headerlink" href="#start-the-scylladb-manager-agent-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<p><strong>On each scylla node</strong> instruct Systemd to start the agent process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl start scylla-manager-agent
</pre></div>
</div>
<p>Ensure that it is running with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager-agent
</pre></div>
</div>
<p>It should have a status of <em>“Active: active (running)”</em>.</p>
</section>
<section id="start-the-scylladb-manager-server">
<h3>Start the ScyllaDB Manager Server<a class="headerlink" href="#start-the-scylladb-manager-server" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> instruct Systemd to start the server process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl start scylla-manager
</pre></div>
</div>
<p>Ensure that it is started with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager
</pre></div>
</div>
<p>It should have a status of <em>“Active: active (running)”</em>.</p>
</section>
<section id="validate-status-of-the-cluster">
<h3>Validate status of the cluster<a class="headerlink" href="#validate-status-of-the-cluster" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> check the version of the client and the server:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool version
Client version: <span class="m">3</span>.x.y-0.20200123.7cf18f6b
Server version: <span class="m">3</span>.x.y-0.20200123.7cf18f6b
</pre></div>
</div>
<p>Check that cluster is up:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool status -c &lt;cluster&gt;
</pre></div>
</div>
<p>All running nodes should be up.</p>
</section>
</section>
<section id="rollback-procedure">
<h2>Rollback Procedure<a class="headerlink" href="#rollback-procedure" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rolling back is not recommended because updated versions contains bug fixes and performance optimizations so you will be going back to a lesser version. This should be only used as a last resort.</p>
</div>
<p>Rollback procedure contains the same steps as upgrade but with downgrading the components to older version:</p>
<ul class="simple">
<li><p>Stop all Scylla Manager tasks (or wait for them to finish)</p></li>
<li><p>Stop the Scylla Manager Server</p></li>
<li><p>Stop the Scylla Manager Agent on all nodes</p></li>
<li><p>Downgrade the Scylla Manager Server and Client</p></li>
<li><p>Downgrade the Scylla Manager Agent on all nodes</p></li>
<li><p>Bring back old configuration (if there was conflict)</p></li>
<li><p>Start the Scylla Manager Agent on all nodes</p></li>
<li><p>Start the Scylla Manager Server</p></li>
<li><p>Validate status of the cluster</p></li>
</ul>
</section>
<section id="rollback-steps">
<h2>Rollback steps<a class="headerlink" href="#rollback-steps" title="Permalink to this headline">¶</a></h2>
<section id="stop-all-scylladb-manager-tasks-or-wait-for-them-to-finish">
<h3>Stop all ScyllaDB Manager tasks (or wait for them to finish)<a class="headerlink" href="#stop-all-scylladb-manager-tasks-or-wait-for-them-to-finish" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> check current status of the manager tasks:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool tasks -c &lt;cluster&gt;
</pre></div>
</div>
<p>None of the listed tasks should have status in RUNNING.</p>
</section>
<section id="id1">
<h3>Stop the ScyllaDB Manager Server<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> instruct Systemd to stop the server process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop scylla-manager
</pre></div>
</div>
<p>Ensure that it is stopped with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager
</pre></div>
</div>
<p>It should have a status of <em>“Active: inactive (dead)”</em>.</p>
</section>
<section id="id2">
<h3>Stop the ScyllaDB Manager Agent on all nodes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><strong>On each scylla node</strong> in the cluster run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop scylla-manager-agent
</pre></div>
</div>
<p>Ensure that it is stopped with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager-agent
</pre></div>
</div>
<p>It should have a status of <em>“Active: inactive (dead)”</em>.</p>
</section>
<section id="downgrade-the-scylladb-manager-server-and-client">
<h3>Downgrade the ScyllaDB Manager Server and Client<a class="headerlink" href="#downgrade-the-scylladb-manager-server-and-client" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> instruct package manager to downgrade server and the client:</p>
<p>CentOS, Red Hat:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo yum downgrade scylla-manager-server-2.x* scylla-manager-client-2.x* -y
</pre></div>
</div>
<p>Debian, Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get install scylla-manager-server<span class="o">=</span><span class="m">2</span>.x scylla-manager-client<span class="o">=</span><span class="m">2</span>.x -y
</pre></div>
</div>
</section>
<section id="downgrade-the-scylladb-manager-agent-on-all-nodes">
<h3>Downgrade the ScyllaDB Manager Agent on all nodes<a class="headerlink" href="#downgrade-the-scylladb-manager-agent-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<p><strong>On each scylla node</strong> instruct package manager to downgrade the agent:</p>
<p>CentOS, Red Hat:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo yum downgrade scylla-manager-agent-2.x* -y
</pre></div>
</div>
<p>Debian, Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get install scylla-manager-agent<span class="o">=</span><span class="m">2</span>.x -y
</pre></div>
</div>
</section>
<section id="revert-to-the-old-configuration">
<h3>Revert to the old configuration<a class="headerlink" href="#revert-to-the-old-configuration" title="Permalink to this headline">¶</a></h3>
<p>If you followed instructions from the Upgrade Steps section and you had configuration conflict when upgrading, then listing the configuration directory should give you both new and old configuration:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/etc/scylla-manager/scylla-manager.yaml <span class="c1"># New version that you want to disable</span>
/etc/scylla-manager/scylla-manager.yaml.old <span class="c1"># Previous version that you want to rollback</span>
</pre></div>
</div>
<p>To restore the old configuration:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /etc/scylla-manager/
mv scylla-manager.yaml scylla-manager.yaml.new
mv scylla-manager.yaml.old scylla-manager.yaml
</pre></div>
</div>
<p>The procedure is the same for the Scylla Manager Agent (on all nodes):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /etc/scylla-manager-agent/
mv scylla-manager-agent.yaml scylla-manager-agent.yaml.new
mv scylla-manager-agent.yaml.old scylla-manager-agent.yaml
</pre></div>
</div>
</section>
<section id="id3">
<h3>Start the ScyllaDB Manager Agent on all nodes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>On all nodes instruct Systemd to start the agent process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl start scylla-manager-agent
</pre></div>
</div>
<p>Ensure that it is running with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager-agent
</pre></div>
</div>
<p>It should have a status of <em>“Active: active (running)”</em>.</p>
</section>
<section id="id4">
<h3>Start the ScyllaDB Manager Server<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> instruct Systemd to start the server process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop scylla-manager
</pre></div>
</div>
<p>Ensure that it is stopped with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status scylla-manager
</pre></div>
</div>
<p>It should have a status of <em>“Active: active (running)”</em>.</p>
</section>
<section id="id5">
<h3>Validate status of the cluster<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p><strong>On the Manager Server</strong> check the version of the client and the server:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool version
Client version: <span class="m">2</span>.x
Server version: <span class="m">2</span>.x
</pre></div>
</div>
<p>Check that cluster is up:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sctool status -c &lt;cluster&gt;
</pre></div>
</div>
<p>All running nodes should be up.</p>
</section>
</section>
</section>

                
                    <div class="post-content">
                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="../install-scylla-manager-agent.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Install ScyllaDB Manager Agent
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../add-a-cluster.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Add a Cluster
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__title">
            Scylla Manager
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                master
            
            <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="index.html">master</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../stable/upgrade/index.html">3.0</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-2.6/index.html">2.6</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-2.5/index.html">2.5</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-2.4/index.html">2.4</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-2.3/index.html">2.3</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-2.2/index.html">2.2</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install-scylla-manager.html">Install ScyllaDB Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install-scylla-manager-agent.html">Install ScyllaDB Manager Agent</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">ScyllaDB Manager Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add-a-cluster.html">Add a Cluster</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../backup/index.html">Backup</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../backup/setup-amazon-s3.html">Setup Amazon S3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backup/setup-s3-compatible-storage.html">Setup S3 compatible storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backup/setup-gcs.html">Setup Google Cloud Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backup/setup-azure-blobstorage.html">Setup Azure Blob Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backup/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backup/specification.html">Specification</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../restore/index.html">Restore</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../restore/download-files-command.html">Download files command</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../repair/index.html">Repair</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../repair/repair-faster.html">Repair faster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../repair/repair-slower.html">Repair slower</a></li>
<li class="toctree-l2"><a class="reference internal" href="../repair/examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../health-check.html">Health Check</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sctool/index.html">CLI sctool</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../sctool/global-flags-and-variables.html">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/completion.html">Completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/backup.html">Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/cluster.html">Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/info.html">Info</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/progress.html">Progress</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/repair.html">Repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/start.html">Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/status.html">Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/stop.html">Stop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/suspend-resume.html">Suspend &amp; Resume</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/task.html">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctool/version.html">Version</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../config/index.html">Configuration Files</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../config/scylla-manager-config.html">Scylla Manager Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config/scylla-manager-agent-config.html">Scylla Manager Agent Config</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../swagger/index.html">Swagger File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scylla-monitoring.html">ScyllaDB Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference external" href="https://scylladb-users.slack.com/archives/C01ERVBPWLU">Slack</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla-manager/issues/new?title=docs:%20Issue in page ScyllaDB Manager Upgrade&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://manager.docs.scylladb.com/master/upgrade/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a href="https://github.com/scylladb/scylla-manager/edit/master/docs/source/upgrade/index.rst"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">ScyllaDB Manager Upgrade</a><ul>
<li><a class="reference internal" href="#applicable-versions">Applicable versions</a></li>
<li><a class="reference internal" href="#upgrade-procedure">Upgrade Procedure</a></li>
<li><a class="reference internal" href="#upgrade-steps">Upgrade steps</a><ul>
<li><a class="reference internal" href="#stop-all-scylla-manager-tasks-or-wait-for-them-to-finish">Stop all Scylla Manager tasks (or wait for them to finish)</a></li>
<li><a class="reference internal" href="#stop-the-scylladb-manager-server">Stop the ScyllaDB Manager Server</a></li>
<li><a class="reference internal" href="#stop-the-scylladb-manager-agent-on-all-nodes">Stop the ScyllaDB Manager Agent on all nodes</a></li>
<li><a class="reference internal" href="#upgrade-the-scylladb-manager-server-and-client">Upgrade the ScyllaDB Manager Server and Client</a></li>
<li><a class="reference internal" href="#upgrade-the-scylladb-manager-agent-on-all-nodes">Upgrade the ScyllaDB Manager Agent on all nodes</a></li>
<li><a class="reference internal" href="#run-scyllamgr-agent-setup-script-on-all-nodes">Run <cite>scyllamgr_agent_setup</cite> script on all nodes</a></li>
<li><a class="reference internal" href="#reconcile-configuration-files">Reconcile configuration files</a></li>
<li><a class="reference internal" href="#start-the-scylladb-manager-agent-on-all-nodes">Start the ScyllaDB Manager Agent on all nodes</a></li>
<li><a class="reference internal" href="#start-the-scylladb-manager-server">Start the ScyllaDB Manager Server</a></li>
<li><a class="reference internal" href="#validate-status-of-the-cluster">Validate status of the cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rollback-procedure">Rollback Procedure</a></li>
<li><a class="reference internal" href="#rollback-steps">Rollback steps</a><ul>
<li><a class="reference internal" href="#stop-all-scylladb-manager-tasks-or-wait-for-them-to-finish">Stop all ScyllaDB Manager tasks (or wait for them to finish)</a></li>
<li><a class="reference internal" href="#id1">Stop the ScyllaDB Manager Server</a></li>
<li><a class="reference internal" href="#id2">Stop the ScyllaDB Manager Agent on all nodes</a></li>
<li><a class="reference internal" href="#downgrade-the-scylladb-manager-server-and-client">Downgrade the ScyllaDB Manager Server and Client</a></li>
<li><a class="reference internal" href="#downgrade-the-scylladb-manager-agent-on-all-nodes">Downgrade the ScyllaDB Manager Agent on all nodes</a></li>
<li><a class="reference internal" href="#revert-to-the-old-configuration">Revert to the old configuration</a></li>
<li><a class="reference internal" href="#id3">Start the ScyllaDB Manager Agent on all nodes</a></li>
<li><a class="reference internal" href="#id4">Start the ScyllaDB Manager Server</a></li>
<li><a class="reference internal" href="#id5">Validate status of the cluster</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <img src="../_static/img/icons/icon-forum.svg" alt="Forum Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2023, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 28 March 2023.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.4.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>